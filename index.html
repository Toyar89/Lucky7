<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LUCKY 7</title>

<!-- PWA essentials -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#17173A" />

<!-- iOS install support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon-512.png">

<style>
  :root { --bg:#17173A; --fg:#ffffff; --card:#ffffff; --accent:#ffffff; }

  body {
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--fg);
    margin: 0;
    padding: 20px;
    text-align: center;
  }

  .logo {
    width: clamp(160px, 30vw, 360px);
    height: auto;
    display: block;
    margin: 0 auto 18px;
  }

  .cards {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 12px;
    margin: 20px 0;
  }
  .card-container { perspective: 1000px; }
  .card-inner {
    width: clamp(90px, 12vw, 120px);
    height: clamp(150px, 21vw, 200px);
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    cursor: pointer;
  }
  .card.flipped .card-inner { transform: rotateY(180deg); cursor: default; }
  .card-face {
    position: absolute; width: 100%; height: 100%;
    border-radius: 12px; backface-visibility: hidden;
    display: flex; align-items: center; justify-content: center;
    font-size: clamp(28px, 4vw, 48px); font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  .card-front { background: royalblue; }
  .card-back  { background: var(--card); color: #000; transform: rotateY(180deg); }
  .position-label { font-size: clamp(14px, 2vw, 18px); margin-top: 6px; color: var(--fg); }

  .scoreboard { display: flex; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap; }
  .scorebox, .timer {
    background: var(--card); color: #000; padding: 10px 20px; border-radius: 8px;
    font-size: 18px; min-width: 100px; font-weight: bold;
  }

  .button-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin-top: 15px;
    flex-wrap: nowrap;
  }

  #gameButton {
    padding: 14px 60px;
    min-width: 220px;
    font-size: 20px;
    font-weight: bold;
    border-radius: 8px;
    background: var(--card);
    color: #000;
    border: none;
    cursor: pointer;
    flex: 0 1 auto;
  }
  #gameButton:hover { background: #eee; }

  #howToPlayButton {
    padding: 14px 40px;
    min-width: 200px;
    font-size: 20px;
    font-weight: bold;
    border-radius: 8px;
    background: var(--bg);
    color: var(--fg);
    border: 2px solid var(--accent);
    cursor: pointer;
    flex: 0 1 auto;
  }
  #howToPlayButton:hover { background: #1e1e45; }

  @media (max-width: 420px) {
    .button-row { gap: 10px; }
    #gameButton { padding: 12px 36px; min-width: 180px; font-size: 18px; }
    #howToPlayButton { padding: 12px 26px; min-width: 150px; font-size: 18px; }
  }

  @keyframes winCardFlash { 0%, 100% { background-color: gold; } 50% { background-color: white; } }
  .winFlash .card-back { animation: winCardFlash 0.4s alternate infinite; }

  @keyframes bustBackgroundFlash { 0%, 100% { background-color: rgba(255,0,0,0.3); } 50% { background-color: rgba(255,0,0,0.9); } }
  .bustFlash .card-back { animation: bustBackgroundFlash 0.6s infinite; color: white; }

  #status { margin-top: 15px; font-size: clamp(16px, 2.4vw, 20px); font-weight: bold; }
 .timeUp { font-size: 1.4em; /* smaller text */
  color: red;
  font-weight: bold;
}
  .copyright { font-size: 1em; margin-top: 10px; opacity: 0.8; }

  #howToPlayModal {
    display: none; position: fixed; z-index: 10000; left: 0; top: 0;
    width: 100%; height: 100%; overflow: auto;
    background-color: rgba(0,0,0,0.75);
    backdrop-filter: blur(2px);
  }
  #howToPlayContent {
    background-color: #1D1D3F; color: white;
    margin: 8% auto; padding: 20px 22px;
    border-radius: 12px; max-width: 420px; width: calc(100% - 40px);
    text-align: left; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
  }
  #howToPlayContent h2 { text-align: center; margin: 0 0 10px; }
  #howToPlayContent p { margin: 8px 0; line-height: 1.5; font-size: 16px; }
  .howto-actions { text-align: center; margin-top: 14px; }
  .howto-actions button {
    padding: 10px 24px;
    background: var(--card);
    color: #000;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
  }
  .howto-actions button:hover { background: #eee; }

  @media (max-width: 480px) {
    #howToPlayContent { margin-top: 14%; }
    #howToPlayContent p { font-size: 18px; line-height: 1.6; }
    #howToPlayContent h2 { font-size: 22px; }
  }

  /* Confetti canvas */
  canvas.confetti { position: fixed; inset: 0; pointer-events: none; }

  /* Floating Install button (only appears when installable) */
  #installPromptBtn {
    display: none;
    position: fixed;
    right: 16px;
    bottom: 16px;
    padding: 12px 16px;
    font-weight: bold;
    border-radius: 10px;
    border: 2px solid #fff;
    background: #17173A;
    color: #fff;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    z-index: 10001;
    cursor: pointer;
  }
  #installPromptBtn:hover { background:#1e1e45; }
</style>
</head>
<body>

<img class="logo" src="logo.png?v=3" alt="Lucky 7"/>

<div class="cards" id="cardContainer"></div>
<div id="status">Pick any card to start.</div>

<div class="button-row">
  <button id="gameButton" onclick="startGame()">Start</button>
  <button id="howToPlayButton" onclick="showHowToPlay()">How to Play</button>
</div>

<div class="scoreboard">
  <div class="scorebox">Won: <span id="winCount">0</span></div>
  <div class="scorebox">Lost: <span id="loseCount">0</span></div>
  <div class="timer" id="timer">01:00</div>
</div>

<div class="copyright">¬© Kev Shirreffs 2025</div>

<!-- Modal -->
<div id="howToPlayModal">
  <div id="howToPlayContent">
    <h2>How to Play</h2>
    <p>üéØ You have 7 facedown cards numbered <strong>1 to 7</strong> on the front.</p>
    <p>üîÑ The back of each card has a number (also <strong>1 to 7</strong>) in a random order.</p>
    <p>üÉè Start by picking any card.</p>
    <p>üìç The number you reveal tells you which <strong>position</strong> you must flip next.</p>
    <p>üèÜ Reveal <strong>all 7 cards</strong> without repeating a position to win.</p>
    <p>‚ùå If a number points to a card that‚Äôs already face-up, you <strong>bust</strong> and lose.</p>
    <div class="howto-actions">
      <button onclick="closeHowToPlay()">Got it!</button>
    </div>
  </div>
</div>

<!-- Sounds -->
<audio id="winSound"    src="applause.mp3"></audio>
<audio id="bustSound"   src="boom.mp3"></audio>
<audio id="timeUpSound" src="timeup.mp3"></audio>

<!-- add preload so it‚Äôs ready instantly -->
<audio id="flipSound"   src="click.mp3" preload="auto"></audio>

  
<!-- Floating Install button -->
<button id="installPromptBtn">Install App</button>

<script>
/* ---------- Confetti ---------- */
(function () {
  const canvas = document.createElement('canvas');
  canvas.className = 'confetti';
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  let W, H, particles = [], running = false, endTime = 0;

  function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
  window.addEventListener('resize', resize); resize();

  function spawn(n = 5) {
    for (let i = 0; i < n; i++) {
      particles.push({
        x: Math.random() * W, y: -10,
        vx: (Math.random() - 0.5) * 2, vy: 2 + Math.random() * 3,
        size: 4 + Math.random() * 6, rot: Math.random() * Math.PI, vr: (Math.random() - 0.5) * 0.2,
        shape: Math.random() < 0.5 ? 'rect' : 'circle'
      });
    }
  }
  function step() {
    ctx.clearRect(0, 0, W, H);
    particles.forEach(p => {
      p.x += p.vx; p.y += p.vy; p.rot += p.vr;
      if (p.y > H + 20) { p.y = -10; p.x = Math.random() * W; }
      ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
      ctx.fillStyle = ['#FFD700','#FF3B3B','#4CAF50','#42A5F5','#FF9800'][Math.floor((p.rot*10)%5+5)%5];
      if (p.shape === 'rect') ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6);
      else { ctx.beginPath(); ctx.arc(0,0,p.size/2,0,Math.PI*2); ctx.fill(); }
      ctx.restore();
    });
  }
  function loop() {
    if (!running) return;
    step();
    if (Date.now() < endTime) { spawn(3); requestAnimationFrame(loop); }
    else { running = false; particles = []; ctx.clearRect(0, 0, W, H); }
  }
  window.launchConfetti = function (durationMs = 5000) {
    endTime = Date.now() + durationMs;
    if (!running) { running = true; loop(); }
  };
})();

/* ---------- Game logic ---------- */
let cards = [], revealed = [], gameOver = false, requiredPosition = null, firstMoveMade = false;
let winCount = 0, loseCount = 0;
let timerInterval, timerStarted = false, timeLeft = 60, timerDone = false;

function startGame() {
  if (timerDone) return;

  cards = shuffle([1,2,3,4,5,6,7]);
  revealed = Array(7).fill(false);
  gameOver = false;
  requiredPosition = null;
  firstMoveMade = false;

  const container = document.getElementById("cardContainer");
  container.innerHTML = "";

  for (let i = 0; i < 7; i++) {
    const wrapper = document.createElement("div");
    wrapper.className = "card-container";

    const card = document.createElement("div");
    card.className = "card";
    card.dataset.index = i;

    const cardInner = document.createElement("div");
    cardInner.className = "card-inner";

    const front = document.createElement("div");
    front.className = "card-face card-front";

    const back = document.createElement("div");
    back.className = "card-face card-back";
    back.textContent = "";

    cardInner.appendChild(front);
    cardInner.appendChild(back);
    card.appendChild(cardInner);
    wrapper.appendChild(card);

    const label = document.createElement("div");
    label.className = "position-label";
    label.textContent = i + 1;

    wrapper.appendChild(label);
    container.appendChild(wrapper);

    card.addEventListener("click", () => handleTurn(i, card, back));
  }

  document.getElementById("status").textContent = "Pick any card to start.";
  const btn = document.getElementById("gameButton");
  btn.textContent = "Restart";
}

function handleTurn(index, cardElement, backElement) {
  if (gameOver || timerDone) return;

  if (!firstMoveMade) {
    document.getElementById("status").textContent = "";
    firstMoveMade = true;
    if (!timerStarted) { startTimer(); timerStarted = true; }
  }
  if (requiredPosition !== null && index !== requiredPosition - 1) return;
  if (revealed[index]) return;

  revealed[index] = true;
  cardElement.classList.add("flipped");
  backElement.textContent = cards[index];
  requiredPosition = cards[index];

  if (revealed[requiredPosition - 1] && !gameOver) {
    bust(requiredPosition - 1);
  }

  if (revealed.every(r => r)) handleWin();
}

function handleWin() {
  document.getElementById("winSound").play();
  winCount++;
  document.getElementById("winCount").textContent = winCount;
  document.getElementById("status").textContent = "üéâ You win! All cards revealed.";

  const allCards = document.querySelectorAll(".card");
  allCards.forEach(c => {
    c.classList.remove("bustFlash");
    c.classList.add("flipped", "winFlash");
    const idx = c.dataset.index;
    c.querySelector(".card-back").textContent = cards[idx];
  });

  launchConfetti(5000);
  setTimeout(() => allCards.forEach(c => c.classList.remove("winFlash")), 5000);

  gameOver = true;
}

function bust(index) {
  document.getElementById("bustSound").play();
  loseCount++;
  document.getElementById("loseCount").textContent = loseCount;
  const bustedCard = document.querySelectorAll(".card")[index];
  bustedCard.classList.add("flipped", "bustFlash");
  bustedCard.querySelector(".card-back").textContent = cards[index];
  document.getElementById("status").textContent = "‚ùå Try again";
  gameOver = true;
}

function shuffle(arr) { let a=[...arr]; for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

function startTimer() {
  const display = document.getElementById("timer");
  display.textContent = formatTime(timeLeft);
  timerInterval = setInterval(() => {
    timeLeft--;
    display.textContent = formatTime(timeLeft);
    if (timeLeft <= 0) {
      document.getElementById("timeUpSound").play();
      clearInterval(timerInterval);
      timerDone = true; gameOver = true;
      document.getElementById("status").innerHTML = "<span class='timeUp'>‚è∞ TIME UP</span>";
      const btn = document.getElementById("gameButton");
      btn.textContent = "Play"; btn.onclick = () => location.reload();
    }
  }, 1000);
}

function formatTime(s){ const m=Math.floor(s/60), sec=s%60; return `${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`; }

function showHowToPlay(){ document.getElementById("howToPlayModal").style.display = "block"; }
function closeHowToPlay(){ document.getElementById("howToPlayModal").style.display = "none"; }

/* ---------- PWA install flow ---------- */
let deferredPrompt = null;
const installBtn = document.getElementById('installPromptBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent the mini-infobar and store the event for later
  e.preventDefault();
  deferredPrompt = e;
  // Show our button
  installBtn.style.display = 'block';
});

installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  // Hide the button regardless of choice; you can re-show later if dismissed
  installBtn.style.display = 'none';
  deferredPrompt = null;
});

// Optional: hide the button once installed
window.addEventListener('appinstalled', () => {
  installBtn.style.display = 'none';
  deferredPrompt = null;
});

/* ---------- Service worker registration ---------- */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js').catch(() => {});
  });
}

/* ---------- Init ---------- */
startGame();
</script>
</body>
</html>









